matrixFont v2.3. Руководство пользователя
=========================================

![](light/screenshots/matrixFont.png)

[TOC]

# Введение

**matrixFont** позволяет создавать, редактировать растровые шрифты и генерировать код *C* для подключения созданного шрифта к проекту программного обеспечения.

Основная область применения — разработка проектов программного обеспечения с использованием графического интерфейса пользователя во встраиваемых системах.

---

Возможности **matrixFont**:

- растровый шрифт:
  
  - размеры символа от 1 × 1 до 512 × 512,
  - диапазон символов от 0 до 255,
  - выбор кодовой страницы (кодировки),
  - компактный собственный формат файла **RHF**,
  - поддержка загрузки/сохранения шрифта в формате **RBF**,
  - поддержка загрузки/сохранения шрифта в формате **Adobe BDF**,

- создание проекта:
  
  - на основе системного шрифта,
  - из кода (поддержка форматов *matrixFont*, *AdaFruit GFX*, *LCD Vision V1.34*),
  - из изображения карты символов с метаинформацией,

- редактор символов:
  
  - удобное редактирование мышью,
  - масштабирование рабочего поля колесом мыши,
  - копирование, вставка и перемещение символов,
  - импортирование изображения в символ,
  - история операций редактирования для каждого символа,
  - операции: инверсия, отображение, поворот, сдвиг, прижатие, центрирование символов,
  - пакетное редактирование всех символов шрифта,

- навигация и предпросмотр:
  
  - навигатор по символам с отображением символов,
  - поиск символов по коду или по названию,
  - просмотр образца текста,
  - карта символов,
  - экспортирование карты символов в изображение,

- инструменты:
  
  - изменение диапазона символов шрифта,  
  - изменение размера символов шрифта,
  - оптимизация размера символов,
  - генератор кода *C* с тонкой настройкой,

- интерфейс:
  
  - интуитивный и дружественный дизайн,
  - полная поддержка дисплеев разной плотности,
  - поддержка локализаций,
  - поддержка тем: светлая и темная,
  - гибкость — настройка внешнего вида, цветов и многого другого,

- а также:
  
  - подробная справка,
  - поддержка онлайн-обновления.

# Проект шрифта

**matrixFont** работает с проектами в собственном оригинальном формате. Кроме этого, есть несколько вариантов создать проект шрифта из уже существующего шрифта в другом формате, используя инструменты [импорта](#импорт).

## Создание

![Диалоговое окно создания нового шрифта](light/screenshots/new.png)

Команда `Файл > Новый шрифт…` открывает диалоговое окно создания нового шрифта.

Задайте название, автора, кодировку, код первого и последнего символа, ширину и высоту символа в пикселях. После нажатия кнопки `Создать` будет создан новый шрифт с заданными свойствами.

При запуске **matrixFont** автоматически создается новый шрифт с параметрами по умолчанию, которые можно изменить в настройках, вкладка *Новый шрифт*. Если установлен флажок `Загружать последний открытый файл при запуске` (настройки, вкладка *Разное*), вместо создания нового шрифта будет загружен последний ранее открытый файл.

В **matrixFont** всегда открыт один проект шрифта, закрыть проект невозможно. Можно создать или загрузить другой проект, который заменит собой предыдущий. Также не поддерживается работа с несколькими проектами в одном экземпляре **matrixFont**. Вместо этого можно запустить несколько экземпляров **matrixFont**, каждый со своим проектом.

## Сохранение

Созданный и отредактированный шрифт можно сохранить в файл. **matrixFont** использует собственный компактный формат **RHF (Raster Hardware Font)**. Чтобы сохранить шрифт, используйте эти команды:

| Кнопка                     | Команда меню `Файл` | Что делает                                                                                                  |
|:--------------------------:|:-------------------:| ----------------------------------------------------------------------------------------------------------- |
| ![](light/svg/save.svg)    | `Сохранить`         | Если шрифт был загружен из файла, то команда перезапишет исходный файл, иначе предложит диалог выбора файла |
| ![](light/svg/save-as.svg) | `Сохранить как…`    | Всегда отображает диалог выбора файла, в который сохранять шрифт.                                           |

В диалоге выбора файла выберите **Raster H/W Font (matrixFont original) \*.RHF** в выпадающем списке *Тип файла*, чтобы сохранить шрифт в собственном компактном формате.

### Сохранение в формат RBF

В **matrixFont v2.1** появилась поддержка сохранения шрифта в формате RBF. При этом шрифт RBF экспортируется из внутреннего представления шрифта **matrixFont**. Некоторые второстепенные свойства, заданные в **matrixFont**, будут утрачены.

Если выбрать в диалоге сохранения формат *Raw Bitmap Font \*.RBF*, после подтверждения появится окно с настройками экспорта в RBF.

![Сохранение в формат RBF](light/screenshots/export-rbf.png)

Чтобы получить хорошо выглядящий пропорциональный шрифт, перед сохранением лучше прижать все символы к левому краю холста. Для создания моноширинного шрифта стоит отцентрировать все символы по горизонтали.

> **RBF (Raw Bitmap Font)** — это простой [формат](http://fileformats.archiveteam.org/wiki/Raw_Bitmap_Font) шрифта, который хранит данные шрифта в виде сырого растрового изображения. Это базовый и легковесный формат шрифта, который использовался в ранних компьютерных системах и встроенных устройствах, где память и место на носителе были ограничены. Шрифты RBF все еще могут использоваться в некоторых специализированных приложениях или устаревших системах.
> 
> Этот формат используется в альтернативной прошивке [CHDK](https://chdk.fandom.com/wiki/CHDK) (Canon Hack Development Kit). При этом CHDK игнорирует параметры **Межстрочное расстояние** и **Смещение базовой линии**.

### Сохранение в формат Adobe BDF

В **matrixFont v2.3** появилась поддержка сохранения шрифта в формате Adobe BDF v2.1 (Glyph Bitmap Distribution Format). При этом шрифт Adobe BDF экспортируется из внутреннего представления шрифта **matrixFont**. Некоторые второстепенные свойства, заданные в **matrixFont**, будут утрачены. Некоторые свойства Adobe BDF, которые не поддерживаются **matrixFont**, будут установлены по умолчанию или опущены, если возможно.

Если выбрать в диалоге сохранения формат *Glyph Bitmap Distribution Format by Adobe \*.BDF*, после подтверждения появится окно с настройками экспорта в Adobe BDF.

![Сохранение в формат Adobe BDF](light/screenshots/export-bdf.png)

Чтобы получить хорошо выглядящий пропорциональный шрифт, перед сохранением лучше прижать все символы к левому краю холста. Для создания моноширинного шрифта стоит отцентрировать все символы по горизонтали.

> **Glyph Bitmap Distribution Format** (BDF) — созданный компанией Adobe [формат](http://fileformats.archiveteam.org/wiki/BDF) файлов для хранения растровых шрифтов. Содержимое файла представлено в текстовом виде, удобочитаемом как для человека, так и для компьютера. Обычно BDF используется в UNIX-средах, в частности в X Window System. [[wiki](https://ru.wikipedia.org/wiki/Bitmap_Distribution_Format)]

## Загрузка

Команда `Файл > Открыть…` позволяет выбрать и загрузить файл шрифта в формате **RHF (Raster H/W Font)**, который является родным для **matrixFont**. Также можно загрузить шрифт, просто перетащив файл в окно. Перетаскивание в окно также работает для всех других поддерживаемых форматов шрифта и изображений.

### Загрузка из файла RBF

В **matrixFont v2.1** появилась поддержка загрузки шрифта в формате RBF, который импортируется во внутреннее представление шрифта **matrixFont**.

### Загрузка из файла Adobe BDF

В **matrixFont v2.3** появилась поддержка загрузки шрифта в формате Adobe BDF v2.1, который импортируется во внутреннее представление шрифта **matrixFont**.

Шрифты Adobe BDF поддерживают Unicode и могут содержать больше 256 символов, поэтому в **matrixFont** будет загружен только поддиапазон символов, в соответствии с кодировкой текущего открытого проекта.

Размер холста может увеличиться, если загружаемый шрифт имеет больший размер символов, чем текущий, и никогда не уменьшается. Иногда такое поведение может быть полезным, если файл шрифта Adobe BDF имеет некорректные свойства и не удается правильно рассчитать размер холста, что может привести к обрезке символов при загрузке. В случае обрезания символов при загрузке, повторите загрузку еще раз, предварительно увеличив [размер холста](#изменение-размера-холста). Также после загрузки может быть полезно [оптимизировать](#оптимизация-размера-холста) размер холста.

## Импорт

Кроме загрузки шрифта из файлов, в **matrixFont** имеется еще несколько вариантов создать проект шрифта из уже существующего шрифта в другом представлении:

- [из установленного в системе шрифта](#из-системного-шрифта),
- [из кода *С*](#из-кода-c),
- [из карты символов](#из-карты-символов) с метаинформацией.

### Из системного шрифта

![Диалоговое окно импорта системного шрифта](light/screenshots/import-font.png)

**matrixFont** может создать проект, используя установленный в системе шрифт (TTF, OTF, FON и др.).

Команда `Файл > Импорт шрифта…` открывает диалоговое окно **Импорт шрифта**.

Выберите шрифт, задайте его размер и начертание. Размеры холста символа устанавливаются автоматически, но их можно изменить.

Контролируйте вид символов по образцу текста, который выводится в верхней части окна. Образец можно масштабировать колесом мыши.

Задайте также следующие опции:

- кодировка (кодовая страница) — определяет набор символов шрифта,
- прижатие символов к левому краю холста,
- оптимизация пустого пространства вокруг символа.

### Из кода *C*

**matrixFont** может создать проект из кода *C*: команда `Файл > Импорт кода C…` открывает соответствующее диалоговое окно. В нем есть две вкладки: **Код C** и **Параметры декодера**.

#### Вкладка *Код C*

![Импорт кода C — вкладка "Код C"](light/screenshots/import-code-1.png)

На вкладке **Код C** можно задать код, из которого будет декодирован шрифт. Перетащите файл с кодом в окно импорта или просто вставьте код из буфера обмена комбинацией `Ctrl + V`.

#### Вкладка *Параметры декодера*

![Импорт кода C — вкладка "Параметры декодера"](light/screenshots/import-code-2.png)

На вкладке **Параметры декодера** можно настроить параметры для корректного считывания символов шрифта из кода.

Слева в окне отображается символ предпросмотра, который задается полями под ним.

Вверху отображается образец текста (до 8 символов), который задается и отключается элементами под ним.

Значение параметра **Тип шрифта** задает основной алгоритм декодирования:

- **matrixFont** — собственный формат кода; может потребоваться дополнительно указать способ считывания и порядок бит, остальные параметры будут считаны из макроопределений.
- **AdaFruit GFX** — формат кода шрифтов от *AdaFruit*.
- **LCD Vision V1.34** — формат кода утилиты *LCD Vision V1.34*, может потребоваться дополнительно указать способ считывания.
- **Настройка вручную** — декодер настраивается подбором всех доступных параметров вручную.

#### Подбор параметров вручную

![Импорт кода C — подбор параметров вручную](light/screenshots/import-code-3.png)

Если параметр **Тип шрифта** установлен в *Настройка вручную*, то требуется задать все параметры. Можно придерживаться следующего ориентировочного алгоритма:

1. Просмотреть код, часто из идентификаторов, структуры или комментариев можно извлечь некоторые из параметров. Для параметров, которые точно известны, можно пропустить некоторые описанные ниже пункты.
2. Установить максимальный **диапазон символов** 0 … 255.
3. Установить параметры **смещение массива/символа** в 0.
4. Установить символ предпросмотра (слева) первый из диапазона, т. е. с кодом начала диапазона. При этом **образец текста** (вверху) можно временно отключить для повышения производительности.
5. Установить **размер холста** в несколько раз больше предполагаемого размера символа.
6. Установить **способ считывания** *Столбцами групп* и **ширину** побольше. Изменяя **высоту**, попытаться получить осмысленное изображение, похожее на строку из символов, в предпросмотре.
7. Если получается строка, но символы в ней повернуты на 90°, тогда изменить параметр **способ считывания**. Теперь установить **высоту** побольше в несколько раз, и изменяя **ширину**, снова попытаться получить осмысленное изображение.
8. При подборе параметров п. 6 и п. 7 время от времени изменять параметр **порядок бит** и **считывание битов группы**, что может помочь получить осмысленное изображение.
9. Постепенно уменьшать **высоту** (или **ширину**, для параметра **способ считывания** *Столбцами групп*) до размера символа. Можно также подобрать размер, при котором в предпросмотре будет видно целое количество символов: разделив подобранное значение на это количество, получим искомый размер.
10. Если **образец текста** (вверху окна) выводится символами с разным смещением по вертикали, изменять параметр **смещение символа**, пока символы не будут выводиться ровной линией.
11. Если не удается полностью избавиться от артефактов на образце текста, изменять параметр **смещение массива**.
12. Постепенно увеличивать начало диапазона, пока не получится правильный **образец текста**.

Это примерный способ подбора параметров. В конкретном случае можно попробовать и другие, более подходящие, способы.

### Из карты символов

Это уникальная опция, позволяющая считать проект шрифта из PNG-изображения [карты символов](#карта-символов), ранее сгенерированного **matrixFont**.

Откройте изображение командой `Символ > Импорт изобажения…` или просто перетащите и бросьте его в редактор. Подтвердите импорт из карты символов в появившемся диалоге.

> **Обратите внимание**.
> 
> Импортирование шрифта возможно только из изображения карты, которое не изменялось с момента его создания (экспорта). Подробнее об этом — см. [Карта символов](#карта-символов), [Метаинформация карты](#метаинформация-карты).
> 
> Если в изображении не будет обнаружено метаинформации, тогда произойдет обычный [импорт изображения](#импорт-изображения) на холст.

## Свойства шрифта

![Окно просмотра свойств шрифта](light/screenshots/props.png)

Команда `Инструменты > Свойства шрифта…` отображает окно просмотра служебной и дополнительной информации о шрифте и файле.

В окне **Свойства шрифта** отображаются следующие данные:

- название, также используется при генерировании кода *C*,
- автор,
- кодовая страница, или же кодировка,
- размеры холста символов — ширина и высота,
- диапазон символов — коды первого и последнего символов,
- расположение файла, если проект был сохранен или загружен из файла,
- дата и приложение создания проекта,
- дата и приложение сохранения последней правки.

Название, автора и кодировку шрифта можно изменить, после чего нажать кнопку `Применить`, чтобы изменения были внесены. Остальные данные носят информационный характер и не подлежат редактированию в этом окне. Для изменения диапазона или размеров холста есть специальные [инструменты](#инструменты-правки-шрифта), описанные далее.

# Главное окно

![Главное окно matrixFont](light/screenshots/find.svg)

1. Панель **Файл**.

2. Главное меню.

3. Панель **Инструменты**.

4. Информация о проекте: кодировка и размер холста.

5. [Навигатор](#навигатор).

6. [Редактор](#редактор) символа.

7. Панель [**Инструменты шрифта**](#пакетное-редактирование).

8. Статусная строка.

9. Панель [поиска](#поиск).

10. Панель [**Инструменты символа**](#операции-редактирования-символа).

## Навигатор

Навигатор — левая часть главного окна **matrixFont**. Это список символов шрифта, который позволяет быстро перемещаться между символами. Также отображает код символа (десятичный или шестнадцатеричный) и его начертание текущим редактируемым шрифтом.

Навигатор можно скрыть: команда-флажок `Вид > Навигатор` или флажок во всплывающем меню панелей инструментов.

Высоту строки можно изменить колесом мыши с зажатой клавишей `Ctrl` или в настройках. В настройках на вкладке *Навигатор* доступно еще несколько дополнительных опций.

![Настройки, вкладка "Навигатор"](light/screenshots/sett-nav.png)

## Редактор

Редактор символов — правая часть главного окна **matrixFont**.

Изображение в редакторе можно масштабировать колесом мыши или командами из раздела меню `Вид > Масштаб:`. Команда `Вид > Вписать` задает оптимальный масштаб так, чтобы холст целиком помещался в редакторе.

Флажок `Вид > Сетка` управляет видимостью пиксельной сетки холста. В настройках на вкладке *Редактор* можно включить шахматный фон в дополнение к сетке или вместо нее.

![Настройки, вкладка "Редактор"](light/screenshots/sett-editor.png)

# Редактирование

**matrixFont** поддерживает несколько приемов редактирования шрифта:

- [пиксельное](#пиксельное-редактирование) редактирование символа,
- [операции](#операции-редактирования-символа) с символом,
- [пакетное](#пакетное-редактирование) редактирование всех символов,
- специальные [инструменты](#инструменты-правки-шрифта) правки шрифта.

## Пиксельное редактирование

Пиксельное редактирование осуществляется мышью в редакторе символа.

Щелчок левой кнопкой устанавливает пиксель, правой — очищает, средней — инвертирует.

Щелчок кнопкой мыши и удерживание `Ctrl` редактирует всю строку.

Щелчок кнопкой мыши и удерживание `Shift` редактирует весь столбец.

## Операции редактирования символа

Операции редактирования символа расположены в меню `Символ` и на панели `Инструменты символа` справа от редактора.

| Кнопка                               | Меню `Символ`         | Действие                                                                                                                  |
|:------------------------------------:|:---------------------:| ------------------------------------------------------------------------------------------------------------------------- |
| ![](light/svg/brush.svg)             | `Очистить`            | Очищает символ                                                                                                            |
| ![](light/svg/invert.svg)            | `Инвертировать`       | Инвертирует все пиксели символа                                                                                           |
| ![](light/svg/mirror-horizontal.svg) | `Отобразить > …`      | Зеркально отображает символ в выбранном направлении                                                                       |
| ![](light/svg/arrow-shift-right.svg) | `Сдвиг > …`           | Перемещает символ на одну строку или столбец                                                                              |
| ![](light/svg/arrow-cross.svg)       | `Сдвиг > С переносом` | Если этот флажок установлен, то при сдвиге крайний вытесняющийся столбец или строка вставляется с противоположной стороны |
| ![](light/svg/arrow-snap-right.svg)  | `Прижать > …`         | Перемещает символ к выбранному краю так, чтобы не осталось чистого столбца или строки с этого края                        |
| ![](light/svg/center-horizontal.svg) | `Центрировать > …`    | Перемещает символ так, чтобы он оказался посередине в выбранном направлении                                               |

## Пакетное редактирование

Операции пакетного редактирования применяются ко всем символам шрифта. По действию они аналогичны операциям с символом, находятся в меню `Шрифт` и на панели `Инструменты шрифта` слева от навигатора.

Также есть и некоторые другие команды:

| Кнопка                        | Меню `Шрифт`                                               | Действие                                                                                                                                                         |
|:-----------------------------:|:----------------------------------------------------------:| ---------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![](light/svg/arrow-up.svg)   | `Переместить символы > Переместить вверх`                  | Обменивает местами текущий символ и предыдущий                                                                                                                   |
| ![](light/svg/arrow-down.svg) | `Переместить символы > Переместить вниз`                   | Обменивает местами текущий символ и следующий за ним                                                                                                             |
| ![](light/svg/range-down.svg) | `Переместить символы > Перемещать весь нижний поддиапазон` | Если этот флажок включен, то команды `Переместить вверх` и `Переместить вниз` будут циклически перемещать все символы в поддиапазоне ниже от выделенного символа |

## Инструменты правки шрифта

**matrixFont** поддерживает несколько специальных инструментов правки всего шрифта:

- [задание диапазона символов](#задание-диапазона-символов),
- [изменение размера холста](#изменение-размера-холста),

### Задание диапазона символов

![Диалоговое окно "Задать диапазон"](light/screenshots/set-range.png)

Команда `Инструменты > Задать диапазон…` открывает диалоговое окно, в котором можно добавить в шрифт новые символы или убрать ненужные (только с краев диапазона), задав коды первого и последнего символов шрифта.

Если некоторые символы из предыдущего диапазона не войдут в новый диапазон, то они все еще будут сохраняться до закрытия проекта. Если новый диапазон содержит символы, которые не входили в предыдущий диапазон, то они будут созданы пустыми.

### Изменение размера холста

![Диалоговое окно "Изменение размера холста"](light/screenshots/set-sizes.png)

Команда `Инструменты > Изменить размер холста…` открывает диалоговое окно, в котором можно изменить и/или оптимизировать размер холста символов существующего шрифта. Полями ввода задается на сколько пикселей с каждой стороны нужно изменить размер. Положительное значение в поле расширит холст с указанной стороны, отрицательное — уменьшит (обрежет).

> **Обратите внимание!**
> 
> После изменении размера холста история правок всех символов будет *утеряна*. Эту операцию невозможно отменить после применения.

#### Оптимизация размера холста

![Оптимизация размера холста в окне "Изменение размера холста"](light/screenshots/set-optimize.png)

Оптимизация размера холста удаляет общие для всех символов пустые ряды (строки или столбцы) с указанных сторон холста. Чтобы задействовать оптимизацию, нужно включить кнопку-стрелку. Поле над ним станет неактивным, а его значение будет автоматически подобрано так, чтобы удалить общий пустой ряд символов.

## История правок

Каждый символ имеет свою историю правок, которая хранит все этапы редактирования. История правок доступна только в текущем сеансе работы. История очищается у всех символов при [создании](#создание) нового шрифта, [загрузке](#загрузка) шрифта из файла или применении некоторых [инструментов](#инструменты-правки-шрифта).

Для перемещения по истории правок символа используются команды `Отменить` и `Повторить` из меню `Символ`.

Для отмены или повтора пакетной операции предназначены команды `Отменить` и `Повторить` из меню `Шрифт`, которые применяют соответствующие символьные команды ко всем символам шрифта одновременно.

В настройках, вкладка *Редактор*, можно задать максимальное количество отмен правок символа. Учтите, что чем больший размер холста и большая глубина истории, тем больше требуется оперативной памяти.

## Копирование и вставка

Меню `Символ` содержит команды для работы с буфером обмена: `Вырезать`, `Копировать`, `Вставить`. При копировании и вырезании в буфер обмена помещается весь символ целиком. Копирование происходит в стандартный графический формат, что позволяет затем вставить скопированный символ в любой растровый графический редактор.

При вставке символа из буфера обмена его верхний левый край совмещается с верхним левым краем текущего холста. Вставка возможна только ранее скопированного в **matrixFont** символа или скопированной в графическом редакторе области изображения. Чтобы вставить другое произвольное изображение из файла, можно воспользоваться [импортом изображения](#импорт-изображения).

Поддерживается копирование/вставка символов между холстами разных размеров. Если вставляемый символ:

- больше текущего холста — вставляется только часть, которая помещается на текущем холсте,
- меньше текущего холста — вставляется целиком, а оставшаяся часть текущего холста не будет изменена.

Также есть команда пакетной вставки `Шрифт > Пакетная вставка`, которая вставляет содержимое буфера обмена во все символы одновременно.

Меню `Символ > Режим вставки` позволяет выбрать один из 4 режимов вставки. Эти же режимы можно выбрать в контекстном меню статусной строки:

| Режим вставки   | Описание                                                             |
| --------------- | -------------------------------------------------------------------- |
| Замена (NORM)   | вставляемый символ заменяет текущий                                  |
| И (AND)         | операция `И` между пикселями вставляемого символа и текущего         |
| ИЛИ (OR)        | операция `ИЛИ` между пикселями вставляемого символа и текущего       |
| Искл. ИЛИ (XOR) | операция `Искл. ИЛИ` между пикселями вставляемого символа и текущего |

В режимах вставки AND/OR/XOR операции работают интерпретируя установленный пиксель как 1, а очищенный — как 0.

## Импорт изображения

Команда `Символ > Импорт изображения…` дает возможность создать символ из произвольного изображения в одном из широко используемых графических форматов. Также можно просто перетащить графический файл в редактор.

При импорте в текущий символ будет вставлено бинаризованное изображение. Порог черного можно задать в настройках **matrixFont**, вкладка *Редактор*.

Изображение импортируется пиксель в пиксель. Если размер изображения больше размера символа, будет вставлена только часть изображения, начиная с левого верхнего угла.

## Поиск

Команда-флажок `Вид > Найти символ` позволяет быстро найти нужный символ в навигаторе и перейти к его редактированию. Если флажок установлен, в нижней части редактора отображается панель поиска, где можно задать поиск по символу или по его десятичному коду.

# Образец текста

![Окно образца текста](light/screenshots/example.png)

Команда `Инструменты > Образец текста…` показывает окно с образцом текста для визуальной оценки создаваемого шрифта. Образец можно масштабировать колесом мыши, текущий масштаб отображается в заголовке окна.

Переключатель **Пропорциональный/Моноширинный** позволяет задать стиль формирования строк из символов:

- ***пропорциональный*** — все межсимвольные интервалы одинаковы и задаются значением поля **дистанция между символами**,
- ***моноширинный*** — все символы располагаются в ячейках виртуальной сетки шириной равной ширине символа, интервал между ячейками задается значением поля **дистанция между символами**.

Заданный здесь стиль формирования строк определяет только отрисовку образца текста, и не имеет отношения ни к свойствам шрифта, ни к генерированию кода.

Поле **дистанция между строками** позволяет задать дистанцию между верхом текущей строки и низом предыдущей.

| Кнопка                                  | Что делает                                                                                                                                                                                                                                  |
|:---------------------------------------:| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![](light/svg/generate-lightning.svg)   | Обновляет изображение образца. Изображение предпросмотра может обновляться автоматически при изменении символов в редакторе. Это можно задать в настройках, вкладка *Разное*, флажок `Обновлять образец текста предпросмотра автоматически` |
| ![](light/svg/pencil.svg)               | Кнопка-флажок, если нажата — отображается поле, в котором можно изменить текст образца. Текст может быть произвольным                                                                                                                       |
| ![](light/svg/update-circle-arrows.svg) | Восстанавливает текст образца по умолчанию                                                                                                                                                                                                  |
| ![](light/svg/export-file.svg)          | Открывает диалог сохранения текущего изображения образца в формате **PNG**                                                                                                                                                                  |

# Карта символов

![Окно карты символов](light/screenshots/map.png)

Команда `Инструменты > Карта символов…` показывает окно с таблицей всех символов шрифта.

Доступно несколько настроек отображения карты:

- в выпадающем списке **Столбцы** можно выбрать количество столбцов таблицы, кратное 2,
- дистанция между символами по **горизонтали**,
- дистанция между символами по **вертикали**.

Таблица символов растягивается по горизонтали так, чтобы заполнить всю ширину окна, при этом высота символов изменяется пропорционально. Щелчок по символу открывает его в редакторе.

Кнопка `Экспорт в изображение` открывает диалог сохранения изображения. Изображение карты символов имеет ту же схему расположения символов, что и в окне. В настройках, вкладка *Карта*, можно задать опции экспорта:

- пустое пространство вокруг символа, в пикселях, применяется до масштабирования,
- коэффициент масштабирования — кратность увеличения символов, чем больше значение, тем больше разрешение изображения.

![Настройки, вкладка "Карта"](light/screenshots/sett-map.png)

## Метаинформация карты

Экспортированное изображение карты символов содержит в себе метаинформацию, которая может быть использована для обратного импорта шрифта из изображения. Однако, импортирование шрифта возможно только из изображения карты, которое не редактировалось с момента экспорта. Можно только пересохранять в форматы без потерь при сжатии. Изменение размера, обрезка, изменение цветов, редактирование и т. п. операции приведут к утере метаинформации, что в свою очередь сделает невозможным импортирование проекта шрифта из этого изображения.

С использованием метаинформации появляется возможность хранить шрифт в графическом формате, что дает возможность оценивать шрифт, не открывая его в **matrixFont**. Однако имейте в виду, что при этом некоторые неосновные свойства проекта могут быть утрачены.

# Генерирование кода *C*

После завершения редактирования шрифта можно сгенерировать соответствующий код на языке *C* для использования шрифта в проектах программного обеспечения. Команда `Инструменты > Генерировать код…` открывает окно генератора кода *C*.

В окне генератора есть две вкладки: **Настройки вывода** и **Вывод**.

![Генератор кода, вкладка "Настройки вывода"](light/screenshots/gen-params.png)

Во вкладке **Настройки вывода** можно гибко настроить параметры генерирования кода.

Генерирование базируется на том, что каждый пиксель символа кодируется одним битом двоичного числа. Каждая строка или столбец, в зависимости от очередности, начинают кодироваться новым числом, т. е. выравниваются по разрядности числа, т. о. это **не** битовый поток.

![Генератор кода, вкладка "Вывод"](light/screenshots/gen-code.png)

На вкладке **Вывод** расположено единственное поле, в котором содержится сгенерированный код.

| Кнопка                                | Что делает                                                                                                                                           |
|:-------------------------------------:| ---------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![](light/svg/gear.svg)               | Показывает вкладку **Настройки вывода**                                                                                                              |
| ![](light/svg/code-c.svg)             | Показывает вкладку **Вывод**                                                                                                                         |
| ![](light/svg/pin-on-top.svg)         | Кнопка-флажок, управляет видимостью окна генератора поверх главного окна **matrixFont**                                                              |
| ![](light/svg/generate-lightning.svg) | Обновляет код. Удобно использовать, если окно генератора открыто вместе с главным окном **matrixFont**, в котором продолжается редактирование шрифта |
| ![](light/svg/copy.svg)               | Копирует код в буфер обмена                                                                                                                          |
| ![](light/svg/export-file.svg)        | Открывает диалог сохранения кода в заголовочный файл *C*                                                                                             |

# Настройки

**matrixFont** имеет различные настройки внешнего вида и поведения.

| Кнопка                        | Команда меню             | Что делает                                                                                                                                                              |
|:-----------------------------:|:------------------------:| ----------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| ![](light/svg/pin-on-top.svg) | `Вид > Поверх всех окон` | Команда-флажок, управляет видимостью главного окна **matrixFont** — если флажок установлен, то оно всегда будет отображаться поверх других окон, даже если теряет фокус |
| ![](light/svg/gear.svg)       | `Файл > Настройки`       | Открывает окно *Настройки*                                                                                                                                              |
|                               | `Вид > Панели:`          | Раздел меню с флажками, которые позволяет задать видимость панелей инструментов                                                                                         |

Большинство настроек доступны в окне *Настройки*.

![Окно "Настройки"](light/screenshots/sett-common.png)

## Интернет и обновление

**matrixFont** может автоматически проверять и скачивать обновленную версию. Доступ к сети Интернет **matrixFont** использует исключительно для проверки обновлений. Обновление запрашивается только с сервера [gitlab.com](https://gitlab.com/riva-lab/matrixFont/-/releases). Приложение не требует доступ к сети для нормальной работы. Если сеть не доступна, **matrixFont** просто не сможет проверить наличие обновлений.

Настроить способ обновления и частоту проверки можно в настройках на вкладке *Общие*.

> **Обратите внимание.**
> 
> Если **matrixFont** был установлен для всех пользователей (естественно, с использованием прав администратора), то при обычном запуске от имени пользователя обновить его не удастся из-за отсутствия у пользователя разрешения на изменение файлов. В таком случае, когда **matrixFont** предложит обновиться, закройте его, запустите заново от имени администратора и обновите.

## Прилипание окон

![Пример организации окон с помощью функции прилипания](light/screenshots/sticking.png)

**matrixFont** имеет несколько окон, каждое из которых имеет свое назначение. Иногда, для удобства работы, может понадобиться отображать несколько окон одновременно. Тогда, чтобы окна не были беспорядочно разбросаны по рабочему столу, можно "прилепить" их к главному окну.

Также имейте в виду, что для сохранения упорядоченности, перемещать эту группу окон следует перемещением главного окна **matrixFont**. В противном случае при перемещении вспомогательного окна остальные окна будут оставаться на прежних местах.

Такое поведение можно задать в окне *Настройки*, вкладка *Прилипание*. Порядок прилипания определяет какое из окон будет прилеплено первым, какое — вторым к созданной группе окон, и т. д.

![Настройки, вкладка "Прилипание"](light/screenshots/sett-sticking.png)

# Помощь в локализации интерфейса

Хотите видеть интерфейс **matrixFont** на своем родном языке? Вы можете внести свой вклад в перевод **matrixFont**.

**matrixFont** разработан с возможностью легкой локализации интерфейса. Файлы локализаций размещаются в каталоге [bin/lang](../bin/lang).

Пожалуйста, осуществите перевод на другой язык, следуя нижеприведенным инструкциям:

1. Откройте файл-шаблон `<project_name>.pot` (каталог bin/lang) в [Poedit](https://poedit.net).
2. Создайте новый перевод для языка, на который будете переводить.
3. Осуществите перевод с русского на свой родной язык и сохраните переведенный файл как `<project_name>.xx.po`, где `xx` — суффикс локали, обычно уже подставлен при выборе языка перевода, может быть вида `xx_yy`.
4. Вы можете использовать другой уже переведенный файл `*.??.po` в качестве опорного, если не знаете язык оригинала.
5. Предложите свой перевод на странице разработки проекта на [gitlab.com](https://gitlab.com/riva-lab/matrixFont/-/issues), открыв новое обсуждение с заголовком вида `i18n: language <your-locale> <new/fix/etc>`.
6. Если хотите использовать свой перевод, не дожидаясь его включения в релиз, добавьте в `languages.ini` определение для своего перевода:
   - увеличьте значение `Count` на единицу (`Count` показывает число доступных локализаций),
   - добавьте строку вида `L-<index>=<locale><description>`, например, `L-2=RU, Russian - Русский`,
   - обратите внимание, строка должна начинаться с суффикса локали (например, `ru` или `ru_ru`, регистр не имеет значения, пробелы и запятые после локали игнорируются).

## Список доступных языков

| Суффикс | Язык                               | Автор           | Переведено |
|:------- | ---------------------------------- | --------------- | ---------- |
| `ru`    | Русский (оригинальный, встроенный) | Riva (riva-lab) | —          |
| `en`    | English                            | Riva (riva-lab) | 100%       |
